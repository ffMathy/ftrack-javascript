(function(e,t){typeof exports=="object"&&typeof module!="undefined"?t(exports,require("moment")):typeof define=="function"&&define.amd?define(["exports","moment"],t):(e=typeof globalThis!="undefined"?globalThis:e||self,t(e["ftrack-javascript-api"]={},e.moment))})(this,function(exports,moment){"use strict";function _interopDefaultLegacy(e){return e&&typeof e=="object"&&"default"in e?e:{default:e}}var moment__default=_interopDefaultLegacy(moment),commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function createBaseFor$1(e){return function(t,r,n){for(var s=-1,a=Object(t),o=n(t),c=o.length;c--;){var l=o[e?c:++s];if(r(a[l],l,a)===!1)break}return t}}var _createBaseFor=createBaseFor$1,createBaseFor=_createBaseFor,baseFor$1=createBaseFor(),_baseFor=baseFor$1;function identity$2(e){return e}var identity_1=identity$2,identity$1=identity_1;function castFunction$1(e){return typeof e=="function"?e:identity$1}var _castFunction=castFunction$1;function baseTimes$1(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var _baseTimes=baseTimes$1,freeGlobal$1=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,Symbol$5=root$7.Symbol,_Symbol=Symbol$5,Symbol$4=_Symbol,objectProto$d=Object.prototype,hasOwnProperty$a=objectProto$d.hasOwnProperty,nativeObjectToString$1=objectProto$d.toString,symToStringTag$1=Symbol$4?Symbol$4.toStringTag:void 0;function getRawTag$1(e){var t=hasOwnProperty$a.call(e,symToStringTag$1),r=e[symToStringTag$1];try{e[symToStringTag$1]=void 0;var n=!0}catch{}var s=nativeObjectToString$1.call(e);return n&&(t?e[symToStringTag$1]=r:delete e[symToStringTag$1]),s}var _getRawTag=getRawTag$1,objectProto$c=Object.prototype,nativeObjectToString=objectProto$c.toString;function objectToString$1(e){return nativeObjectToString.call(e)}var _objectToString=objectToString$1,Symbol$3=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$3?Symbol$3.toStringTag:void 0;function baseGetTag$7(e){return e==null?e===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(e)?getRawTag(e):objectToString(e)}var _baseGetTag=baseGetTag$7;function isObjectLike$7(e){return e!=null&&typeof e=="object"}var isObjectLike_1=isObjectLike$7,baseGetTag$6=_baseGetTag,isObjectLike$6=isObjectLike_1,argsTag$2="[object Arguments]";function baseIsArguments$1(e){return isObjectLike$6(e)&&baseGetTag$6(e)==argsTag$2}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$5=isObjectLike_1,objectProto$b=Object.prototype,hasOwnProperty$9=objectProto$b.hasOwnProperty,propertyIsEnumerable$1=objectProto$b.propertyIsEnumerable,isArguments$2=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike$5(e)&&hasOwnProperty$9.call(e,"callee")&&!propertyIsEnumerable$1.call(e,"callee")},isArguments_1=isArguments$2,isArray$9=Array.isArray,isArray_1=isArray$9,isBuffer$2={exports:{}};function stubFalse(){return!1}var stubFalse_1=stubFalse;(function(e,t){var r=_root,n=stubFalse_1,s=t&&!t.nodeType&&t,a=s&&!0&&e&&!e.nodeType&&e,o=a&&a.exports===s,c=o?r.Buffer:void 0,l=c?c.isBuffer:void 0,u=l||n;e.exports=u})(isBuffer$2,isBuffer$2.exports);var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$2(e,t){var r=typeof e;return t=t==null?MAX_SAFE_INTEGER$1:t,!!t&&(r=="number"||r!="symbol"&&reIsUint.test(e))&&e>-1&&e%1==0&&e<t}var _isIndex=isIndex$2,MAX_SAFE_INTEGER=9007199254740991;function isLength$3(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=MAX_SAFE_INTEGER}var isLength_1=isLength$3,baseGetTag$5=_baseGetTag,isLength$2=isLength_1,isObjectLike$4=isObjectLike_1,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$1="[object Date]",errorTag$1="[object Error]",funcTag$1="[object Function]",mapTag$2="[object Map]",numberTag$1="[object Number]",objectTag$3="[object Object]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$2="[object String]",weakMapTag$1="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag$1]=typedArrayTags[boolTag$1]=typedArrayTags[dataViewTag$2]=typedArrayTags[dateTag$1]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag$2]=typedArrayTags[numberTag$1]=typedArrayTags[objectTag$3]=typedArrayTags[regexpTag$1]=typedArrayTags[setTag$2]=typedArrayTags[stringTag$2]=typedArrayTags[weakMapTag$1]=!1;function baseIsTypedArray$1(e){return isObjectLike$4(e)&&isLength$2(e.length)&&!!typedArrayTags[baseGetTag$5(e)]}var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$1(e){return function(t){return e(t)}}var _baseUnary=baseUnary$1,_nodeUtil={exports:{}};(function(e,t){var r=_freeGlobal,n=t&&!t.nodeType&&t,s=n&&!0&&e&&!e.nodeType&&e,a=s&&s.exports===n,o=a&&r.process,c=function(){try{var l=s&&s.require&&s.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();e.exports=c})(_nodeUtil,_nodeUtil.exports);var baseIsTypedArray=_baseIsTypedArray,baseUnary=_baseUnary,nodeUtil=_nodeUtil.exports,nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray,isTypedArray$2=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$2,baseTimes=_baseTimes,isArguments$1=isArguments_1,isArray$8=isArray_1,isBuffer$1=isBuffer$2.exports,isIndex$1=_isIndex,isTypedArray$1=isTypedArray_1,objectProto$a=Object.prototype,hasOwnProperty$8=objectProto$a.hasOwnProperty;function arrayLikeKeys$2(e,t){var r=isArray$8(e),n=!r&&isArguments$1(e),s=!r&&!n&&isBuffer$1(e),a=!r&&!n&&!s&&isTypedArray$1(e),o=r||n||s||a,c=o?baseTimes(e.length,String):[],l=c.length;for(var u in e)(t||hasOwnProperty$8.call(e,u))&&!(o&&(u=="length"||s&&(u=="offset"||u=="parent")||a&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||isIndex$1(u,l)))&&c.push(u);return c}var _arrayLikeKeys=arrayLikeKeys$2;function isObject$5(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var isObject_1=isObject$5,objectProto$9=Object.prototype;function isPrototype$2(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||objectProto$9;return e===r}var _isPrototype=isPrototype$2;function nativeKeysIn$1(e){var t=[];if(e!=null)for(var r in Object(e))t.push(r);return t}var _nativeKeysIn=nativeKeysIn$1,isObject$4=isObject_1,isPrototype$1=_isPrototype,nativeKeysIn=_nativeKeysIn,objectProto$8=Object.prototype,hasOwnProperty$7=objectProto$8.hasOwnProperty;function baseKeysIn$1(e){if(!isObject$4(e))return nativeKeysIn(e);var t=isPrototype$1(e),r=[];for(var n in e)n=="constructor"&&(t||!hasOwnProperty$7.call(e,n))||r.push(n);return r}var _baseKeysIn=baseKeysIn$1,baseGetTag$4=_baseGetTag,isObject$3=isObject_1,asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(e){if(!isObject$3(e))return!1;var t=baseGetTag$4(e);return t==funcTag||t==genTag||t==asyncTag||t==proxyTag}var isFunction_1=isFunction$2,isFunction$1=isFunction_1,isLength$1=isLength_1;function isArrayLike$3(e){return e!=null&&isLength$1(e.length)&&!isFunction$1(e)}var isArrayLike_1=isArrayLike$3,arrayLikeKeys$1=_arrayLikeKeys,baseKeysIn=_baseKeysIn,isArrayLike$2=isArrayLike_1;function keysIn$1(e){return isArrayLike$2(e)?arrayLikeKeys$1(e,!0):baseKeysIn(e)}var keysIn_1=keysIn$1,baseFor=_baseFor,castFunction=_castFunction,keysIn=keysIn_1;function forIn(e,t){return e==null?e:baseFor(e,castFunction(t),keysIn)}var forIn_1=forIn,baseGetTag$3=_baseGetTag,isArray$7=isArray_1,isObjectLike$3=isObjectLike_1,stringTag$1="[object String]";function isString(e){return typeof e=="string"||!isArray$7(e)&&isObjectLike$3(e)&&baseGetTag$3(e)==stringTag$1}var isString_1=isString;function overArg$2(e,t){return function(r){return e(t(r))}}var _overArg=overArg$2,overArg$1=_overArg,getPrototype$1=overArg$1(Object.getPrototypeOf,Object),_getPrototype=getPrototype$1,baseGetTag$2=_baseGetTag,getPrototype=_getPrototype,isObjectLike$2=isObjectLike_1,objectTag$2="[object Object]",funcProto$2=Function.prototype,objectProto$7=Object.prototype,funcToString$2=funcProto$2.toString,hasOwnProperty$6=objectProto$7.hasOwnProperty,objectCtorString=funcToString$2.call(Object);function isPlainObject(e){if(!isObjectLike$2(e)||baseGetTag$2(e)!=objectTag$2)return!1;var t=getPrototype(e);if(t===null)return!0;var r=hasOwnProperty$6.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&funcToString$2.call(r)==objectCtorString}var isPlainObject_1=isPlainObject;function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1;function eq$2(e,t){return e===t||e!==e&&t!==t}var eq_1=eq$2,eq$1=eq_1;function assocIndexOf$4(e,t){for(var r=e.length;r--;)if(eq$1(e[r][0],t))return r;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(e){var t=this.__data__,r=assocIndexOf$3(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():splice.call(t,r,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(e){var t=this.__data__,r=assocIndexOf$2(t,e);return r<0?void 0:t[r][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(e){return assocIndexOf$1(this.__data__,e)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(e,t){var r=this.__data__,n=assocIndexOf(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}ListCache$4.prototype.clear=listCacheClear,ListCache$4.prototype.delete=listCacheDelete,ListCache$4.prototype.get=listCacheGet,ListCache$4.prototype.has=listCacheHas,ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,ListCache$3=_ListCache;function stackClear$1(){this.__data__=new ListCache$3,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var _stackDelete=stackDelete$1;function stackGet$1(e){return this.__data__.get(e)}var _stackGet=stackGet$1;function stackHas$1(e){return this.__data__.has(e)}var _stackHas=stackHas$1,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var e=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function isMasked$1(e){return!!maskSrcKey&&maskSrcKey in e}var _isMasked=isMasked$1,funcProto$1=Function.prototype,funcToString$1=funcProto$1.toString;function toSource$2(e){if(e!=null){try{return funcToString$1.call(e)}catch{}try{return e+""}catch{}}return""}var _toSource=toSource$2,isFunction=isFunction_1,isMasked=_isMasked,isObject$2=isObject_1,toSource$1=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto=Function.prototype,objectProto$6=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$5=objectProto$6.hasOwnProperty,reIsNative=RegExp("^"+funcToString.call(hasOwnProperty$5).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(e){if(!isObject$2(e)||isMasked(e))return!1;var t=isFunction(e)?reIsNative:reIsHostCtor;return t.test(toSource$1(e))}var _baseIsNative=baseIsNative$1;function getValue$1(e,t){return e==null?void 0:e[t]}var _getValue=getValue$1,baseIsNative=_baseIsNative,getValue=_getValue;function getNative$6(e,t){var r=getValue(e,t);return baseIsNative(r)?r:void 0}var _getNative=getNative$6,getNative$5=_getNative,root$5=_root,Map$3=getNative$5(root$5,"Map"),_Map=Map$3,getNative$4=_getNative,nativeCreate$4=getNative$4(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$5=Object.prototype,hasOwnProperty$4=objectProto$5.hasOwnProperty;function hashGet$1(e){var t=this.__data__;if(nativeCreate$2){var r=t[e];return r===HASH_UNDEFINED$2?void 0:r}return hasOwnProperty$4.call(t,e)?t[e]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function hashHas$1(e){var t=this.__data__;return nativeCreate$1?t[e]!==void 0:hasOwnProperty$3.call(t,e)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet$1(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=nativeCreate&&t===void 0?HASH_UNDEFINED$1:t,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Hash$1.prototype.clear=hashClear,Hash$1.prototype.delete=hashDelete,Hash$1.prototype.get=hashGet,Hash$1.prototype.has=hashHas,Hash$1.prototype.set=hashSet;var _Hash=Hash$1,Hash=_Hash,ListCache$2=_ListCache,Map$2=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$2||ListCache$2),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(e,t){var r=e.__data__;return isKeyable(t)?r[typeof t=="string"?"string":"hash"]:r.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(e){var t=getMapData$3(this,e).delete(e);return this.size-=t?1:0,t}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(e){return getMapData$2(this,e).get(e)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(e){return getMapData$1(this,e).has(e)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(e,t){var r=getMapData(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$3(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}MapCache$3.prototype.clear=mapCacheClear,MapCache$3.prototype.delete=mapCacheDelete,MapCache$3.prototype.get=mapCacheGet,MapCache$3.prototype.has=mapCacheHas,MapCache$3.prototype.set=mapCacheSet;var _MapCache=MapCache$3,ListCache$1=_ListCache,Map$1=_Map,MapCache$2=_MapCache,LARGE_ARRAY_SIZE=200;function stackSet$1(e,t){var r=this.__data__;if(r instanceof ListCache$1){var n=r.__data__;if(!Map$1||n.length<LARGE_ARRAY_SIZE-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new MapCache$2(n)}return r.set(e,t),this.size=r.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$2(e){var t=this.__data__=new ListCache(e);this.size=t.size}Stack$2.prototype.clear=stackClear,Stack$2.prototype.delete=stackDelete,Stack$2.prototype.get=stackGet,Stack$2.prototype.has=stackHas,Stack$2.prototype.set=stackSet;var _Stack=Stack$2,HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd$1(e){return this.__data__.set(e,HASH_UNDEFINED),this}var _setCacheAdd=setCacheAdd$1;function setCacheHas$1(e){return this.__data__.has(e)}var _setCacheHas=setCacheHas$1,MapCache$1=_MapCache,setCacheAdd=_setCacheAdd,setCacheHas=_setCacheHas;function SetCache$1(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new MapCache$1;++t<r;)this.add(e[t])}SetCache$1.prototype.add=SetCache$1.prototype.push=setCacheAdd,SetCache$1.prototype.has=setCacheHas;var _SetCache=SetCache$1;function arraySome$1(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var _arraySome=arraySome$1;function cacheHas$1(e,t){return e.has(t)}var _cacheHas=cacheHas$1,SetCache=_SetCache,arraySome=_arraySome,cacheHas=_cacheHas,COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays$2(e,t,r,n,s,a){var o=r&COMPARE_PARTIAL_FLAG$5,c=e.length,l=t.length;if(c!=l&&!(o&&l>c))return!1;var u=a.get(e);if(u&&a.get(t))return u==t;var p=-1,y=!0,h=r&COMPARE_UNORDERED_FLAG$3?new SetCache:void 0;for(a.set(e,t),a.set(t,e);++p<c;){var d=e[p],g=t[p];if(n)var $=o?n(g,d,p,t,e,a):n(d,g,p,e,t,a);if($!==void 0){if($)continue;y=!1;break}if(h){if(!arraySome(t,function(_,b){if(!cacheHas(h,b)&&(d===_||s(d,_,r,n,a)))return h.push(b)})){y=!1;break}}else if(!(d===g||s(d,g,r,n,a))){y=!1;break}}return a.delete(e),a.delete(t),y}var _equalArrays=equalArrays$2,root$4=_root,Uint8Array$2=root$4.Uint8Array,_Uint8Array=Uint8Array$2;function mapToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n,s){r[++t]=[s,n]}),r}var _mapToArray=mapToArray$1;function setToArray$1(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var _setToArray=setToArray$1,Symbol$2=_Symbol,Uint8Array$1=_Uint8Array,eq=eq_1,equalArrays$1=_equalArrays,mapToArray=_mapToArray,setToArray=_setToArray,COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag$1="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag$1="[object Set]",stringTag="[object String]",symbolTag$1="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag$1="[object DataView]",symbolProto$1=Symbol$2?Symbol$2.prototype:void 0,symbolValueOf=symbolProto$1?symbolProto$1.valueOf:void 0;function equalByTag$1(e,t,r,n,s,a,o){switch(r){case dataViewTag$1:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case arrayBufferTag:return!(e.byteLength!=t.byteLength||!a(new Uint8Array$1(e),new Uint8Array$1(t)));case boolTag:case dateTag:case numberTag:return eq(+e,+t);case errorTag:return e.name==t.name&&e.message==t.message;case regexpTag:case stringTag:return e==t+"";case mapTag$1:var c=mapToArray;case setTag$1:var l=n&COMPARE_PARTIAL_FLAG$4;if(c||(c=setToArray),e.size!=t.size&&!l)return!1;var u=o.get(e);if(u)return u==t;n|=COMPARE_UNORDERED_FLAG$2,o.set(e,t);var p=equalArrays$1(c(e),c(t),n,s,a,o);return o.delete(e),p;case symbolTag$1:if(symbolValueOf)return symbolValueOf.call(e)==symbolValueOf.call(t)}return!1}var _equalByTag=equalByTag$1;function arrayPush$1(e,t){for(var r=-1,n=t.length,s=e.length;++r<n;)e[s+r]=t[r];return e}var _arrayPush=arrayPush$1,arrayPush=_arrayPush,isArray$6=isArray_1;function baseGetAllKeys$1(e,t,r){var n=t(e);return isArray$6(e)?n:arrayPush(n,r(e))}var _baseGetAllKeys=baseGetAllKeys$1;function arrayFilter$1(e,t){for(var r=-1,n=e==null?0:e.length,s=0,a=[];++r<n;){var o=e[r];t(o,r,e)&&(a[s++]=o)}return a}var _arrayFilter=arrayFilter$1;function stubArray$1(){return[]}var stubArray_1=stubArray$1,arrayFilter=_arrayFilter,stubArray=stubArray_1,objectProto$3=Object.prototype,propertyIsEnumerable=objectProto$3.propertyIsEnumerable,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbols$1=nativeGetSymbols?function(e){return e==null?[]:(e=Object(e),arrayFilter(nativeGetSymbols(e),function(t){return propertyIsEnumerable.call(e,t)}))}:stubArray,_getSymbols=getSymbols$1,overArg=_overArg,nativeKeys$1=overArg(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype=_isPrototype,nativeKeys=_nativeKeys,objectProto$2=Object.prototype,hasOwnProperty$2=objectProto$2.hasOwnProperty;function baseKeys$1(e){if(!isPrototype(e))return nativeKeys(e);var t=[];for(var r in Object(e))hasOwnProperty$2.call(e,r)&&r!="constructor"&&t.push(r);return t}var _baseKeys=baseKeys$1,arrayLikeKeys=_arrayLikeKeys,baseKeys=_baseKeys,isArrayLike$1=isArrayLike_1;function keys$3(e){return isArrayLike$1(e)?arrayLikeKeys(e):baseKeys(e)}var keys_1=keys$3,baseGetAllKeys=_baseGetAllKeys,getSymbols=_getSymbols,keys$2=keys_1;function getAllKeys$1(e){return baseGetAllKeys(e,keys$2,getSymbols)}var _getAllKeys=getAllKeys$1,getAllKeys=_getAllKeys,COMPARE_PARTIAL_FLAG$3=1,objectProto$1=Object.prototype,hasOwnProperty$1=objectProto$1.hasOwnProperty;function equalObjects$1(e,t,r,n,s,a){var o=r&COMPARE_PARTIAL_FLAG$3,c=getAllKeys(e),l=c.length,u=getAllKeys(t),p=u.length;if(l!=p&&!o)return!1;for(var y=l;y--;){var h=c[y];if(!(o?h in t:hasOwnProperty$1.call(t,h)))return!1}var d=a.get(e);if(d&&a.get(t))return d==t;var g=!0;a.set(e,t),a.set(t,e);for(var $=o;++y<l;){h=c[y];var _=e[h],b=t[h];if(n)var m=o?n(b,_,h,t,e,a):n(_,b,h,e,t,a);if(!(m===void 0?_===b||s(_,b,r,n,a):m)){g=!1;break}$||($=h=="constructor")}if(g&&!$){var C=e.constructor,A=t.constructor;C!=A&&"constructor"in e&&"constructor"in t&&!(typeof C=="function"&&C instanceof C&&typeof A=="function"&&A instanceof A)&&(g=!1)}return a.delete(e),a.delete(t),g}var _equalObjects=equalObjects$1,getNative$3=_getNative,root$3=_root,DataView$1=getNative$3(root$3,"DataView"),_DataView=DataView$1,getNative$2=_getNative,root$2=_root,Promise$2=getNative$2(root$2,"Promise"),_Promise=Promise$2,getNative$1=_getNative,root$1=_root,Set$1=getNative$1(root$1,"Set"),_Set=Set$1,getNative=_getNative,root=_root,WeakMap$1=getNative(root,"WeakMap"),_WeakMap=WeakMap$1,DataView=_DataView,Map=_Map,Promise$1=_Promise,Set=_Set,WeakMap=_WeakMap,baseGetTag$1=_baseGetTag,toSource=_toSource,mapTag="[object Map]",objectTag$1="[object Object]",promiseTag="[object Promise]",setTag="[object Set]",weakMapTag="[object WeakMap]",dataViewTag="[object DataView]",dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap),getTag$1=baseGetTag$1;(DataView&&getTag$1(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag$1(new Map)!=mapTag||Promise$1&&getTag$1(Promise$1.resolve())!=promiseTag||Set&&getTag$1(new Set)!=setTag||WeakMap&&getTag$1(new WeakMap)!=weakMapTag)&&(getTag$1=function(e){var t=baseGetTag$1(e),r=t==objectTag$1?e.constructor:void 0,n=r?toSource(r):"";if(n)switch(n){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}return t});var _getTag=getTag$1,Stack$1=_Stack,equalArrays=_equalArrays,equalByTag=_equalByTag,equalObjects=_equalObjects,getTag=_getTag,isArray$5=isArray_1,isBuffer=isBuffer$2.exports,isTypedArray=isTypedArray_1,COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]",objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep$1(e,t,r,n,s,a){var o=isArray$5(e),c=isArray$5(t),l=o?arrayTag:getTag(e),u=c?arrayTag:getTag(t);l=l==argsTag?objectTag:l,u=u==argsTag?objectTag:u;var p=l==objectTag,y=u==objectTag,h=l==u;if(h&&isBuffer(e)){if(!isBuffer(t))return!1;o=!0,p=!1}if(h&&!p)return a||(a=new Stack$1),o||isTypedArray(e)?equalArrays(e,t,r,n,s,a):equalByTag(e,t,l,r,n,s,a);if(!(r&COMPARE_PARTIAL_FLAG$2)){var d=p&&hasOwnProperty.call(e,"__wrapped__"),g=y&&hasOwnProperty.call(t,"__wrapped__");if(d||g){var $=d?e.value():e,_=g?t.value():t;return a||(a=new Stack$1),s($,_,r,n,a)}}return h?(a||(a=new Stack$1),equalObjects(e,t,r,n,s,a)):!1}var _baseIsEqualDeep=baseIsEqualDeep$1,baseIsEqualDeep=_baseIsEqualDeep,isObjectLike$1=isObjectLike_1;function baseIsEqual$2(e,t,r,n,s){return e===t?!0:e==null||t==null||!isObjectLike$1(e)&&!isObjectLike$1(t)?e!==e&&t!==t:baseIsEqualDeep(e,t,r,n,baseIsEqual$2,s)}var _baseIsEqual=baseIsEqual$2,Stack=_Stack,baseIsEqual$1=_baseIsEqual,COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch$1(e,t,r,n){var s=r.length,a=s,o=!n;if(e==null)return!a;for(e=Object(e);s--;){var c=r[s];if(o&&c[2]?c[1]!==e[c[0]]:!(c[0]in e))return!1}for(;++s<a;){c=r[s];var l=c[0],u=e[l],p=c[1];if(o&&c[2]){if(u===void 0&&!(l in e))return!1}else{var y=new Stack;if(n)var h=n(u,p,l,e,t,y);if(!(h===void 0?baseIsEqual$1(p,u,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,n,y):h))return!1}}return!0}var _baseIsMatch=baseIsMatch$1,isObject$1=isObject_1;function isStrictComparable$2(e){return e===e&&!isObject$1(e)}var _isStrictComparable=isStrictComparable$2,isStrictComparable$1=_isStrictComparable,keys$1=keys_1;function getMatchData$1(e){for(var t=keys$1(e),r=t.length;r--;){var n=t[r],s=e[n];t[r]=[n,s,isStrictComparable$1(s)]}return t}var _getMatchData=getMatchData$1;function matchesStrictComparable$2(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var _matchesStrictComparable=matchesStrictComparable$2,baseIsMatch=_baseIsMatch,getMatchData=_getMatchData,matchesStrictComparable$1=_matchesStrictComparable;function baseMatches$1(e){var t=getMatchData(e);return t.length==1&&t[0][2]?matchesStrictComparable$1(t[0][0],t[0][1]):function(r){return r===e||baseIsMatch(r,e,t)}}var _baseMatches=baseMatches$1,baseGetTag=_baseGetTag,isObjectLike=isObjectLike_1,symbolTag="[object Symbol]";function isSymbol$4(e){return typeof e=="symbol"||isObjectLike(e)&&baseGetTag(e)==symbolTag}var isSymbol_1=isSymbol$4,isArray$4=isArray_1,isSymbol$3=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$3(e,t){if(isArray$4(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||isSymbol$3(e)?!0:reIsPlainProp.test(e)||!reIsDeepProp.test(e)||t!=null&&e in Object(t)}var _isKey=isKey$3,MapCache=_MapCache,FUNC_ERROR_TEXT="Expected a function";function memoize$1(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(FUNC_ERROR_TEXT);var r=function(){var n=arguments,s=t?t.apply(this,n):n[0],a=r.cache;if(a.has(s))return a.get(s);var o=e.apply(this,n);return r.cache=a.set(s,o)||a,o};return r.cache=new(memoize$1.Cache||MapCache),r}memoize$1.Cache=MapCache;var memoize_1=memoize$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(e){var t=memoize(e,function(n){return r.size===MAX_MEMOIZE_SIZE&&r.clear(),n}),r=t.cache;return t}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(rePropName,function(r,n,s,a){t.push(s?a.replace(reEscapeChar,"$1"):n||r)}),t}),_stringToPath=stringToPath$1;function arrayMap$1(e,t){for(var r=-1,n=e==null?0:e.length,s=Array(n);++r<n;)s[r]=t(e[r],r,e);return s}var _arrayMap=arrayMap$1,Symbol$1=_Symbol,arrayMap=_arrayMap,isArray$3=isArray_1,isSymbol$2=isSymbol_1,INFINITY$2=1/0,symbolProto=Symbol$1?Symbol$1.prototype:void 0,symbolToString=symbolProto?symbolProto.toString:void 0;function baseToString$1(e){if(typeof e=="string")return e;if(isArray$3(e))return arrayMap(e,baseToString$1)+"";if(isSymbol$2(e))return symbolToString?symbolToString.call(e):"";var t=e+"";return t=="0"&&1/e==-INFINITY$2?"-0":t}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$1(e){return e==null?"":baseToString(e)}var toString_1=toString$1,isArray$2=isArray_1,isKey$2=_isKey,stringToPath=_stringToPath,toString=toString_1;function castPath$2(e,t){return isArray$2(e)?e:isKey$2(e,t)?[e]:stringToPath(toString(e))}var _castPath=castPath$2,isSymbol$1=isSymbol_1,INFINITY$1=1/0;function toKey$4(e){if(typeof e=="string"||isSymbol$1(e))return e;var t=e+"";return t=="0"&&1/e==-INFINITY$1?"-0":t}var _toKey=toKey$4,castPath$1=_castPath,toKey$3=_toKey;function baseGet$2(e,t){t=castPath$1(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[toKey$3(t[r++])];return r&&r==n?e:void 0}var _baseGet=baseGet$2,baseGet$1=_baseGet;function get$1(e,t,r){var n=e==null?void 0:baseGet$1(e,t);return n===void 0?r:n}var get_1=get$1;function baseHasIn$1(e,t){return e!=null&&t in Object(e)}var _baseHasIn=baseHasIn$1,castPath=_castPath,isArguments=isArguments_1,isArray$1=isArray_1,isIndex=_isIndex,isLength=isLength_1,toKey$2=_toKey;function hasPath$1(e,t,r){t=castPath(t,e);for(var n=-1,s=t.length,a=!1;++n<s;){var o=toKey$2(t[n]);if(!(a=e!=null&&r(e,o)))break;e=e[o]}return a||++n!=s?a:(s=e==null?0:e.length,!!s&&isLength(s)&&isIndex(o,s)&&(isArray$1(e)||isArguments(e)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$1(e,t){return e!=null&&hasPath(e,t,baseHasIn)}var hasIn_1=hasIn$1,baseIsEqual=_baseIsEqual,get=get_1,hasIn=hasIn_1,isKey$1=_isKey,isStrictComparable=_isStrictComparable,matchesStrictComparable=_matchesStrictComparable,toKey$1=_toKey,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty$1(e,t){return isKey$1(e)&&isStrictComparable(t)?matchesStrictComparable(toKey$1(e),t):function(r){var n=get(r,e);return n===void 0&&n===t?hasIn(r,e):baseIsEqual(t,n,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}var _baseMatchesProperty=baseMatchesProperty$1;function baseProperty$1(e){return function(t){return t==null?void 0:t[e]}}var _baseProperty=baseProperty$1,baseGet=_baseGet;function basePropertyDeep$1(e){return function(t){return baseGet(t,e)}}var _basePropertyDeep=basePropertyDeep$1,baseProperty=_baseProperty,basePropertyDeep=_basePropertyDeep,isKey=_isKey,toKey=_toKey;function property$1(e){return isKey(e)?baseProperty(toKey(e)):basePropertyDeep(e)}var property_1=property$1,baseMatches=_baseMatches,baseMatchesProperty=_baseMatchesProperty,identity=identity_1,isArray=isArray_1,property=property_1;function baseIteratee$2(e){return typeof e=="function"?e:e==null?identity:typeof e=="object"?isArray(e)?baseMatchesProperty(e[0],e[1]):baseMatches(e):property(e)}var _baseIteratee=baseIteratee$2,baseIteratee$1=_baseIteratee,isArrayLike=isArrayLike_1,keys=keys_1;function createFind$1(e){return function(t,r,n){var s=Object(t);if(!isArrayLike(t)){var a=baseIteratee$1(r);t=keys(t),r=function(c){return a(s[c],c,s)}}var o=e(t,r,n);return o>-1?s[a?t[o]:o]:void 0}}var _createFind=createFind$1;function baseFindIndex$1(e,t,r,n){for(var s=e.length,a=r+(n?1:-1);n?a--:++a<s;)if(t(e[a],a,e))return a;return-1}var _baseFindIndex=baseFindIndex$1,isObject=isObject_1,isSymbol=isSymbol_1,NAN=0/0,reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber$1(e){if(typeof e=="number")return e;if(isSymbol(e))return NAN;if(isObject(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=isObject(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(reTrim,"");var r=reIsBinary.test(e);return r||reIsOctal.test(e)?freeParseInt(e.slice(2),r?2:8):reIsBadHex.test(e)?NAN:+e}var toNumber_1=toNumber$1,toNumber=toNumber_1,INFINITY=1/0,MAX_INTEGER=17976931348623157e292;function toFinite$1(e){if(!e)return e===0?e:0;if(e=toNumber(e),e===INFINITY||e===-INFINITY){var t=e<0?-1:1;return t*MAX_INTEGER}return e===e?e:0}var toFinite_1=toFinite$1,toFinite=toFinite_1;function toInteger$1(e){var t=toFinite(e),r=t%1;return t===t?r?t-r:t:0}var toInteger_1=toInteger$1,baseFindIndex=_baseFindIndex,baseIteratee=_baseIteratee,toInteger=toInteger_1,nativeMax=Math.max;function findIndex$1(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var s=r==null?0:toInteger(r);return s<0&&(s=nativeMax(n+s,0)),baseFindIndex(e,baseIteratee(t),s)}var findIndex_1=findIndex$1,createFind=_createFind,findIndex=findIndex_1,find=createFind(findIndex),find_1=find,loglevel$1={exports:{}};(function(e){(function(t,r){e.exports?e.exports=r():t.log=r()})(commonjsGlobal,function(){var t=function(){},r="undefined",n=["trace","debug","info","warn","error"];function s(d,g){var $=d[g];if(typeof $.bind=="function")return $.bind(d);try{return Function.prototype.bind.call($,d)}catch{return function(){return Function.prototype.apply.apply($,[d,arguments])}}}function a(d){return d==="debug"&&(d="log"),typeof console===r?!1:console[d]!==void 0?s(console,d):console.log!==void 0?s(console,"log"):t}function o(d,g){for(var $=0;$<n.length;$++){var _=n[$];this[_]=$<d?t:this.methodFactory(_,d,g)}this.log=this.debug}function c(d,g,$){return function(){typeof console!==r&&(o.call(this,g,$),this[d].apply(this,arguments))}}function l(d,g,$){return a(d)||c.apply(this,arguments)}function u(d,g,$){var _=this,b,m="loglevel";d&&(m+=":"+d);function C(v){var T=(n[v]||"silent").toUpperCase();if(typeof window!==r){try{window.localStorage[m]=T;return}catch{}try{window.document.cookie=encodeURIComponent(m)+"="+T+";"}catch{}}}function A(){var v;if(typeof window!==r){try{v=window.localStorage[m]}catch{}if(typeof v===r)try{var T=window.document.cookie,S=T.indexOf(encodeURIComponent(m)+"=");S!==-1&&(v=/^([^;]+)/.exec(T.slice(S))[1])}catch{}return _.levels[v]===void 0&&(v=void 0),v}}_.name=d,_.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},_.methodFactory=$||l,_.getLevel=function(){return b},_.setLevel=function(v,T){if(typeof v=="string"&&_.levels[v.toUpperCase()]!==void 0&&(v=_.levels[v.toUpperCase()]),typeof v=="number"&&v>=0&&v<=_.levels.SILENT){if(b=v,T!==!1&&C(v),o.call(_,v,d),typeof console===r&&v<_.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+v},_.setDefaultLevel=function(v){A()||_.setLevel(v,!1)},_.enableAll=function(v){_.setLevel(_.levels.TRACE,v)},_.disableAll=function(v){_.setLevel(_.levels.SILENT,v)};var O=A();O==null&&(O=g==null?"WARN":g),_.setLevel(O,!1)}var p=new u,y={};p.getLogger=function(g){if(typeof g!="string"||g==="")throw new TypeError("You must supply a name when creating a logger.");var $=y[g];return $||($=y[g]=new u(g,p.getLevel(),p.methodFactory)),$};var h=typeof window!==r?window.log:void 0;return p.noConflict=function(){return typeof window!==r&&window.log===p&&(window.log=h),p},p.getLoggers=function(){return y},p})})(loglevel$1);var loglevel=loglevel$1.exports,rngBrowser={exports:{}},getRandomValues=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);rngBrowser.exports=function(){return getRandomValues(rnds8),rnds8}}else{var rnds=new Array(16);rngBrowser.exports=function(){for(var t=0,r;t<16;t++)(t&3)==0&&(r=Math.random()*4294967296),rnds[t]=r>>>((t&3)<<3)&255;return rnds}}for(var byteToHex=[],i=0;i<256;++i)byteToHex[i]=(i+256).toString(16).substr(1);function bytesToUuid$1(e,t){var r=t||0,n=byteToHex;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}var bytesToUuid_1=bytesToUuid$1,rng=rngBrowser.exports,bytesToUuid=bytesToUuid_1;function v4(e,t,r){var n=t&&r||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var s=e.random||(e.rng||rng)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,t)for(var a=0;a<16;++a)t[n+a]=s[a];return t||bytesToUuid(s)}var v4_1=v4,socket_ioWebsocketOnly={exports:{}};/*! Socket.IO.js build:0.9.17, development. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */(function(module){const that=typeof window=="undefined"?{}:window;var io=module.exports;(function(){(function(e,t){var r=e;r.version="0.9.17",r.protocol=1,r.transports=[],r.j=[],r.sockets={},r.connect=function(n,s){var a=r.util.parseUri(n),o,c;t&&t.location&&(a.protocol=a.protocol||t.location.protocol.slice(0,-1),a.host=a.host||(t.document?t.document.domain:t.location.hostname),a.port=a.port||t.location.port),o=r.util.uniqueUri(a);var l={host:a.host,secure:a.protocol=="https",port:a.port||(a.protocol=="https"?443:80),query:a.query||""};return r.util.merge(l,s),(l["force new connection"]||!r.sockets[o])&&(c=new r.Socket(l)),!l["force new connection"]&&c&&(r.sockets[o]=c),c=c||r.sockets[o],c.of(a.path.length>1?a.path:"")}})(module.exports,that),function(e,t){var r=e.util={},n=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,s=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];r.parseUri=function(o){for(var c=n.exec(o||""),l={},u=14;u--;)l[s[u]]=c[u]||"";return l},r.uniqueUri=function(o){var c=o.protocol,l=o.host,u=o.port;return"document"in t?(l=l||document.domain,u=u||(c=="https"&&document.location.protocol!=="https:"?443:document.location.port)):(l=l||"localhost",!u&&c=="https"&&(u=443)),(c||"http")+"://"+l+":"+(u||80)},r.query=function(o,c){var l=r.chunkQuery(o||""),u=[];r.merge(l,r.chunkQuery(c||""));for(var p in l)l.hasOwnProperty(p)&&u.push(p+"="+l[p]);return u.length?"?"+u.join("&"):""},r.chunkQuery=function(o){for(var c={},l=o.split("&"),u=0,p=l.length,y;u<p;++u)y=l[u].split("="),y[0]&&(c[y[0]]=y[1]);return c};var a=!1;r.load=function(o){if("document"in t&&document.readyState==="complete"||a)return o();r.on(t,"load",o,!1)},r.on=function(o,c,l,u){o.attachEvent?o.attachEvent("on"+c,l):o.addEventListener&&o.addEventListener(c,l,u)},r.request=function(o){if(o&&typeof XDomainRequest!="undefined"&&!r.ua.hasCORS)return new XDomainRequest;if(typeof XMLHttpRequest!="undefined"&&(!o||r.ua.hasCORS))return new XMLHttpRequest;if(!o)try{return new window[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}return null},typeof window!="undefined"&&r.load(function(){a=!0}),r.defer=function(o){if(!r.ua.webkit||typeof importScripts!="undefined")return o();r.load(function(){setTimeout(o,100)})},r.merge=function(c,l,u,p){var y=p||[],h=typeof u=="undefined"?2:u,d;for(d in l)l.hasOwnProperty(d)&&r.indexOf(y,d)<0&&(typeof c[d]!="object"||!h?(c[d]=l[d],y.push(l[d])):r.merge(c[d],l[d],h-1,y));return c},r.mixin=function(o,c){r.merge(o.prototype,c.prototype)},r.inherit=function(o,c){function l(){}l.prototype=c.prototype,o.prototype=new l},r.isArray=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"},r.intersect=function(o,c){for(var l=[],u=o.length>c.length?o:c,p=o.length>c.length?c:o,y=0,h=p.length;y<h;y++)~r.indexOf(u,p[y])&&l.push(p[y]);return l},r.indexOf=function(o,c,l){for(var u=o.length,l=l<0?l+u<0?0:l+u:l||0;l<u&&o[l]!==c;l++);return u<=l?-1:l},r.toArray=function(o){for(var c=[],l=0,u=o.length;l<u;l++)c.push(o[l]);return c},r.ua={},r.ua.hasCORS=typeof XMLHttpRequest!="undefined"&&function(){try{var o=new XMLHttpRequest}catch{return!1}return o.withCredentials!=null}(),r.ua.webkit=typeof navigator!="undefined"&&/webkit/i.test(navigator.userAgent),r.ua.iDevice=typeof navigator!="undefined"&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(typeof io!="undefined"?io:module.exports,that),function(e,t){e.EventEmitter=r;function r(){}r.prototype.on=function(n,s){return this.$events||(this.$events={}),this.$events[n]?t.util.isArray(this.$events[n])?this.$events[n].push(s):this.$events[n]=[this.$events[n],s]:this.$events[n]=s,this},r.prototype.addListener=r.prototype.on,r.prototype.once=function(n,s){var a=this;function o(){a.removeListener(n,o),s.apply(this,arguments)}return o.listener=s,this.on(n,o),this},r.prototype.removeListener=function(n,s){if(this.$events&&this.$events[n]){var a=this.$events[n];if(t.util.isArray(a)){for(var o=-1,c=0,l=a.length;c<l;c++)if(a[c]===s||a[c].listener&&a[c].listener===s){o=c;break}if(o<0)return this;a.splice(o,1),a.length||delete this.$events[n]}else(a===s||a.listener&&a.listener===s)&&delete this.$events[n]}return this},r.prototype.removeAllListeners=function(n){return n===void 0?(this.$events={},this):(this.$events&&this.$events[n]&&(this.$events[n]=null),this)},r.prototype.listeners=function(n){return this.$events||(this.$events={}),this.$events[n]||(this.$events[n]=[]),t.util.isArray(this.$events[n])||(this.$events[n]=[this.$events[n]]),this.$events[n]},r.prototype.emit=function(n){if(!this.$events)return!1;var s=this.$events[n];if(!s)return!1;var a=Array.prototype.slice.call(arguments,1);if(typeof s=="function")s.apply(this,a);else if(t.util.isArray(s))for(var o=s.slice(),c=0,l=o.length;c<l;c++)o[c].apply(this,a);else return!1;return!0}}(typeof io!="undefined"?io:module.exports,typeof io!="undefined"?io:module.parent.exports),function(exports,nativeJSON){if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={};function f(e){return e<10?"0"+e:e}function date(e,t){return isFinite(e.valueOf())?e.getUTCFullYear()+"-"+f(e.getUTCMonth()+1)+"-"+f(e.getUTCDate())+"T"+f(e.getUTCHours())+":"+f(e.getUTCMinutes())+":"+f(e.getUTCSeconds())+"Z":null}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(t){var r=meta[t];return typeof r=="string"?r:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var r,n,s,a,o=gap,c,l=t[e];switch(l instanceof Date&&(l=date(e)),typeof rep=="function"&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,c=[],Object.prototype.toString.apply(l)==="[object Array]"){for(a=l.length,r=0;r<a;r+=1)c[r]=str(r,l)||"null";return s=c.length===0?"[]":gap?`[
`+gap+c.join(`,
`+gap)+`
`+o+"]":"["+c.join(",")+"]",gap=o,s}if(rep&&typeof rep=="object")for(a=rep.length,r=0;r<a;r+=1)typeof rep[r]=="string"&&(n=rep[r],s=str(n,l),s&&c.push(quote(n)+(gap?": ":":")+s));else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(s=str(n,l),s&&c.push(quote(n)+(gap?": ":":")+s));return s=c.length===0?"{}":gap?`{
`+gap+c.join(`,
`+gap)+`
`+o+"}":"{"+c.join(",")+"}",gap=o,s}}JSON.stringify=function(e,t,r){var n;if(gap="",indent="",typeof r=="number")for(n=0;n<r;n+=1)indent+=" ";else typeof r=="string"&&(indent=r);if(rep=t,t&&typeof t!="function"&&(typeof t!="object"||typeof t.length!="number"))throw new Error("JSON.stringify");return str("",{"":e})},JSON.parse=function(text,reviver){var j;function walk(e,t){var r,n,s=e[t];if(s&&typeof s=="object")for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n=walk(s,r),n!==void 0?s[r]=n:delete s[r]);return reviver.call(e,t,s)}if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(typeof io!="undefined"?io:module.exports,typeof JSON!="undefined"?JSON:void 0),function(e,t){var r=e.parser={},n=r.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],s=r.reasons=["transport not supported","client not handshaken","unauthorized"],a=r.advice=["reconnect"],o=t.JSON,c=t.util.indexOf;r.encodePacket=function(u){var p=c(n,u.type),y=u.id||"",h=u.endpoint||"",d=u.ack,g=null;switch(u.type){case"error":var $=u.reason?c(s,u.reason):"",_=u.advice?c(a,u.advice):"";($!==""||_!=="")&&(g=$+(_!==""?"+"+_:""));break;case"message":u.data!==""&&(g=u.data);break;case"event":var b={name:u.name};u.args&&u.args.length&&(b.args=u.args),g=o.stringify(b);break;case"json":g=o.stringify(u.data);break;case"connect":u.qs&&(g=u.qs);break;case"ack":g=u.ackId+(u.args&&u.args.length?"+"+o.stringify(u.args):"");break}var m=[p,y+(d=="data"?"+":""),h];return g!=null&&m.push(g),m.join(":")},r.encodePayload=function(u){var p="";if(u.length==1)return u[0];for(var y=0,h=u.length;y<h;y++){var d=u[y];p+="\uFFFD"+d.length+"\uFFFD"+u[y]}return p};var l=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;r.decodePacket=function(u){var p=u.match(l);if(!p)return{};var y=p[2]||"",u=p[5]||"",h={type:n[p[1]],endpoint:p[4]||""};switch(y&&(h.id=y,p[3]?h.ack="data":h.ack=!0),h.type){case"error":var p=u.split("+");h.reason=s[p[0]]||"",h.advice=a[p[1]]||"";break;case"message":h.data=u||"";break;case"event":try{var d=o.parse(u);h.name=d.name,h.args=d.args}catch{}h.args=h.args||[];break;case"json":try{h.data=o.parse(u)}catch{}break;case"connect":h.qs=u||"";break;case"ack":var p=u.match(/^([0-9]+)(\+)?(.*)/);if(p&&(h.ackId=p[1],h.args=[],p[3]))try{h.args=p[3]?o.parse(p[3]):[]}catch{}break}return h},r.decodePayload=function(u){if(u.charAt(0)=="\uFFFD"){for(var p=[],y=1,h="";y<u.length;y++)u.charAt(y)=="\uFFFD"?(p.push(r.decodePacket(u.substr(y+1).substr(0,h))),y+=Number(h)+1,h=""):h+=u.charAt(y);return p}else return[r.decodePacket(u)]}}(typeof io!="undefined"?io:module.exports,typeof io!="undefined"?io:module.parent.exports),function(e,t){e.Transport=r;function r(n,s){this.socket=n,this.sessid=s}t.util.mixin(r,t.EventEmitter),r.prototype.heartbeats=function(){return!0},r.prototype.onData=function(n){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),n!==""){var s=t.parser.decodePayload(n);if(s&&s.length)for(var a=0,o=s.length;a<o;a++)this.onPacket(s[a])}return this},r.prototype.onPacket=function(n){return this.socket.setHeartbeatTimeout(),n.type=="heartbeat"?this.onHeartbeat():(n.type=="connect"&&n.endpoint==""&&this.onConnect(),n.type=="error"&&n.advice=="reconnect"&&(this.isOpen=!1),this.socket.onPacket(n),this)},r.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var n=this;this.closeTimeout=setTimeout(function(){n.onDisconnect()},this.socket.closeTimeout)}},r.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},r.prototype.onConnect=function(){return this.socket.onConnect(),this},r.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},r.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},r.prototype.packet=function(n){this.send(t.parser.encodePacket(n))},r.prototype.onHeartbeat=function(n){this.packet({type:"heartbeat"})},r.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},r.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},r.prototype.prepareUrl=function(){var n=this.socket.options;return this.scheme()+"://"+n.host+":"+n.port+"/"+n.resource+"/"+t.protocol+"/"+this.name+"/"+this.sessid},r.prototype.ready=function(n,s){s.call(this)}}(typeof io!="undefined"?io:module.exports,typeof io!="undefined"?io:module.parent.exports),function(e,t,r){e.Socket=n;function n(a){if(this.options={port:80,secure:!1,document:"document"in r?document:!1,resource:"socket.io",transports:t.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},t.util.merge(this.options,a),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||t.util.ua.hasCORS)){var o=this;t.util.on(r,"beforeunload",function(){o.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}t.util.mixin(n,t.EventEmitter),n.prototype.of=function(a){return this.namespaces[a]||(this.namespaces[a]=new t.SocketNamespace(this,a),a!==""&&this.namespaces[a].packet({type:"connect"})),this.namespaces[a]},n.prototype.publish=function(){this.emit.apply(this,arguments);var a;for(var o in this.namespaces)this.namespaces.hasOwnProperty(o)&&(a=this.of(o),a.$emit.apply(a,arguments))};function s(){}n.prototype.handshake=function(a){var o=this,c=this.options;function l(d){d instanceof Error?(o.connecting=!1,o.onError(d.message)):a.apply(null,d.split(":"))}var u=["http"+(c.secure?"s":"")+":/",c.host+":"+c.port,c.resource,t.protocol,t.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!t.util.ua.hasCORS){var p=document.getElementsByTagName("script")[0],y=document.createElement("script");y.src=u+"&jsonp="+t.j.length,p.parentNode.insertBefore(y,p),t.j.push(function(d){l(d),y.parentNode.removeChild(y)})}else{var h=t.util.request();h.open("GET",u,!0),this.isXDomain()&&(h.withCredentials=!0),h.onreadystatechange=function(){h.readyState==4&&(h.onreadystatechange=s,h.status==200?l(h.responseText):h.status==403?o.onError(h.responseText):(o.connecting=!1,!o.reconnecting&&o.onError(h.responseText)))},h.send(null)}},n.prototype.getTransport=function(a){for(var o=a||this.transports,c=0,l;l=o[c];c++)if(t.Transport[l]&&t.Transport[l].check(this)&&(!this.isXDomain()||t.Transport[l].xdomainCheck(this)))return new t.Transport[l](this,this.sessionid);return null},n.prototype.connect=function(a){if(this.connecting)return this;var o=this;return o.connecting=!0,this.handshake(function(c,l,u,p){o.sessionid=c,o.closeTimeout=u*1e3,o.heartbeatTimeout=l*1e3,o.transports||(o.transports=o.origTransports=p?t.util.intersect(p.split(","),o.options.transports):o.options.transports),o.setHeartbeatTimeout();function y(h){if(o.transport&&o.transport.clearTimeouts(),o.transport=o.getTransport(h),!o.transport)return o.publish("connect_failed");o.transport.ready(o,function(){o.connecting=!0,o.publish("connecting",o.transport.name),o.transport.open(),o.options["connect timeout"]&&(o.connectTimeoutTimer=setTimeout(function(){if(!o.connected&&(o.connecting=!1,o.options["try multiple transports"])){for(var d=o.transports;d.length>0&&d.splice(0,1)[0]!=o.transport.name;);d.length?y(d):o.publish("connect_failed")}},o.options["connect timeout"]))})}y(o.transports),o.once("connect",function(){clearTimeout(o.connectTimeoutTimer),a&&typeof a=="function"&&a()})}),this},n.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!(this.transport&&!this.transport.heartbeats())){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}},n.prototype.packet=function(a){return this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a),this},n.prototype.setBuffer=function(a){this.doBuffer=a,!a&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},n.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},n.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},n.prototype.disconnectSync=function(){var a=t.util.request(),o=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,t.protocol,"",this.sessionid].join("/")+"/?disconnect=1";a.open("GET",o,!1),a.send(null),this.onDisconnect("booted")},n.prototype.isXDomain=function(){var a=r.location.port||(r.location.protocol=="https:"?443:80);return this.options.host!==r.location.hostname||this.options.port!=a},n.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},n.prototype.onOpen=function(){this.open=!0},n.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},n.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)},n.prototype.onError=function(a){a&&a.advice&&a.advice==="reconnect"&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",a&&a.reason?a.reason:a)},n.prototype.onDisconnect=function(a){var o=this.connected,c=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(o||c)&&(this.transport.close(),this.transport.clearTimeouts(),o&&(this.publish("disconnect",a),a!="booted"&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},n.prototype.reconnect=function(){this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var a=this,o=this.options["max reconnection attempts"],c=this.options["try multiple transports"],l=this.options["reconnection limit"];function u(){if(a.connected){for(var y in a.namespaces)a.namespaces.hasOwnProperty(y)&&y!==""&&a.namespaces[y].packet({type:"connect"});a.publish("reconnect",a.transport.name,a.reconnectionAttempts)}clearTimeout(a.reconnectionTimer),a.removeListener("connect_failed",p),a.removeListener("connect",p),a.reconnecting=!1,delete a.reconnectionAttempts,delete a.reconnectionDelay,delete a.reconnectionTimer,delete a.redoTransports,a.options["try multiple transports"]=c}function p(){if(!!a.reconnecting){if(a.connected)return u();if(a.connecting&&a.reconnecting)return a.reconnectionTimer=setTimeout(p,1e3);a.reconnectionAttempts++>=o?a.redoTransports?(a.publish("reconnect_failed"),u()):(a.on("connect_failed",p),a.options["try multiple transports"]=!0,a.transports=a.origTransports,a.transport=a.getTransport(),a.redoTransports=!0,a.connect()):(a.reconnectionDelay<l&&(a.reconnectionDelay*=2),a.connect(),a.publish("reconnecting",a.reconnectionDelay,a.reconnectionAttempts),a.reconnectionTimer=setTimeout(p,a.reconnectionDelay))}}this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(p,this.reconnectionDelay),this.on("connect",p)}}(typeof io!="undefined"?io:module.exports,typeof io!="undefined"?io:module.parent.exports,that),function(e,t){e.SocketNamespace=r;function r(s,a){this.socket=s,this.name=a||"",this.flags={},this.json=new n(this,"json"),this.ackPackets=0,this.acks={}}t.util.mixin(r,t.EventEmitter),r.prototype.$emit=t.EventEmitter.prototype.emit,r.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},r.prototype.packet=function(s){return s.endpoint=this.name,this.socket.packet(s),this.flags={},this},r.prototype.send=function(s,a){var o={type:this.flags.json?"json":"message",data:s};return typeof a=="function"&&(o.id=++this.ackPackets,o.ack=!0,this.acks[o.id]=a),this.packet(o)},r.prototype.emit=function(s){var a=Array.prototype.slice.call(arguments,1),o=a[a.length-1],c={type:"event",name:s};return typeof o=="function"&&(c.id=++this.ackPackets,c.ack="data",this.acks[c.id]=o,a=a.slice(0,a.length-1)),c.args=a,this.packet(c)},r.prototype.disconnect=function(){return this.name===""?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},r.prototype.onPacket=function(s){var a=this;function o(){a.packet({type:"ack",args:t.util.toArray(arguments),ackId:s.id})}switch(s.type){case"connect":this.$emit("connect");break;case"disconnect":this.name===""?this.socket.onDisconnect(s.reason||"booted"):this.$emit("disconnect",s.reason);break;case"message":case"json":var c=["message",s.data];s.ack=="data"?c.push(o):s.ack&&this.packet({type:"ack",ackId:s.id}),this.$emit.apply(this,c);break;case"event":var c=[s.name].concat(s.args);s.ack=="data"&&c.push(o),this.$emit.apply(this,c);break;case"ack":this.acks[s.ackId]&&(this.acks[s.ackId].apply(this,s.args),delete this.acks[s.ackId]);break;case"error":s.advice?this.socket.onError(s):s.reason=="unauthorized"?this.$emit("connect_failed",s.reason):this.$emit("error",s.reason);break}};function n(s,a){this.namespace=s,this.name=a}n.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},n.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(typeof io!="undefined"?io:module.exports,typeof io!="undefined"?io:module.parent.exports),function(e,t,r){e.websocket=n;function n(s){t.Transport.apply(this,arguments)}t.util.inherit(n,t.Transport),n.prototype.name="websocket",n.prototype.open=function(){var s=t.util.query(this.socket.options.query),a=this,o;return o||(o=r.MozWebSocket||r.WebSocket),this.websocket=new o(this.prepareUrl()+s),this.websocket.onopen=function(){a.onOpen(),a.socket.setBuffer(!1)},this.websocket.onmessage=function(c){a.onData(c.data)},this.websocket.onclose=function(){a.onClose(),a.socket.setBuffer(!0)},this.websocket.onerror=function(c){a.onError(c)},this},t.util.ua.iDevice?n.prototype.send=function(s){var a=this;return setTimeout(function(){a.websocket.send(s)},0),this}:n.prototype.send=function(s){return this.websocket.send(s),this},n.prototype.payload=function(s){for(var a=0,o=s.length;a<o;a++)this.packet(s[a]);return this},n.prototype.close=function(){return this.websocket.close(),this},n.prototype.onError=function(s){this.socket.onError(s)},n.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},n.check=function(){return"WebSocket"in r&&!("__addTask"in WebSocket)||"MozWebSocket"in r},n.xdomainCheck=function(){return!0},t.transports.push("websocket")}(typeof io!="undefined"?io.Transport:module.exports,typeof io!="undefined"?io:module.parent.exports,that)})()})(socket_ioWebsocketOnly);var io=socket_ioWebsocketOnly.exports;class Event{constructor(t,r,n={}){this._data=Object.assign({topic:t,data:r,target:"",inReplyToEvent:null},n,{id:v4_1(),sent:null})}getData(){return this._data}addSource(t){this._data.source=t}}function errorFactory(e){function t(r,n){this.name=e,this.message=r,this.errorCode=n,this.stack=new Error().stack}return t.prototype=new Error,t}const ServerError=errorFactory("ServerError"),ServerPermissionDeniedError=errorFactory("ServerPermissionDeniedError"),ServerValidationError=errorFactory("ServerValidationError"),EventServerReplyTimeoutError=errorFactory("EventServerReplyTimeoutError"),EventServerConnectionTimeoutError=errorFactory("EventServerConnectionTimeoutError"),NotUniqueError=errorFactory("NotUniqueError"),CreateComponentError=errorFactory("CreateComponentError"),AbortError=errorFactory("AbortError"),exports$3={ServerError,ServerPermissionDeniedError,ServerValidationError,EventServerReplyTimeoutError,EventServerConnectionTimeoutError,NotUniqueError,CreateComponentError,AbortError};function encodeUriParameters(e){return Object.keys(e).map(t=>[t,e[t]].map(encodeURIComponent).join("=")).join("&")}class EventHub{constructor(t,r,n,{applicationId:s="ftrack.api.javascript"}={}){this.logger=loglevel.getLogger("ftrack_api:EventHub"),this._applicationId=s,this._apiUser=r,this._apiKey=n;const a=new RegExp("\\:\\d+$");if(t.match(a))this._serverUrl=t;else{const o=t.lastIndexOf("https",0)===0?"443":"80";this._serverUrl=`${t}:${o}`}this._id=v4_1(),this._replyCallbacks={},this._unsentEvents=[],this._subscribers=[],this._socketIo=null,this._handle=this._handle.bind(this),this._handleReply=this._handleReply.bind(this),this._onSocketConnected=this._onSocketConnected.bind(this)}connect(){this._socketIo=io.connect(this._serverUrl,{"max reconnection attempts":1/0,"reconnection limit":1e4,"reconnection delay":5e3,transports:["websocket"],query:encodeUriParameters({api_user:this._apiUser,api_key:this._apiKey})}),this._socketIo.on("connect",this._onSocketConnected),this._socketIo.on("ftrack.event",this._handle)}isConnected(){return this._socketIo&&this._socketIo.socket.connected||!1}_onSocketConnected(){this.logger.debug("Connected to event server.");try{this.subscribe("topic=ftrack.meta.reply",this._handleReply,{id:this._id})}catch(r){if(r instanceof NotUniqueError)this.logger.debug("Already subscribed to replies.");else throw r}for(const r of this._subscribers)this._notifyServerAboutSubscriber(r);const t=this._unsentEvents;if(t.length){this._unsentEvents=[],this.logger.debug(`Publishing ${t.length} unsent events.`);for(const r of t)this._runWhenConnected(r)}}publish(t,{onReply:r=null,timeout:n=10}={}){t.addSource({id:this._id,applicationId:this._applicationId,user:{username:this._apiUser}});const s=Object.assign({},t.getData()),a=s.id;return new Promise((l,u)=>{this._runWhenConnected(l),n&&setTimeout(()=>{const p=new EventServerConnectionTimeoutError("Unable to connect to event server within timeout.");u(p)},n*1e3)}).then(()=>(r&&(this._replyCallbacks[a]=r),this.logger.debug("Publishing event.",s),this._socketIo.emit("ftrack.event",s),Promise.resolve(a)))}publishAndWaitForReply(t,{timeout:r=30}){return new Promise((s,a)=>{const o=c=>{s(c),this._removeReplyCallback(t.id)};this.publish(t,{timeout:r,onReply:o}),r&&setTimeout(()=>{const c=new EventServerReplyTimeoutError("No reply event received within timeout.");a(c),this._removeReplyCallback(t.id)},r*1e3)})}_removeReplyCallback(t){this._replyCallbacks[t]&&delete this._replyCallbacks[t]}_runWhenConnected(t){this.isConnected()?t():(this.logger.debug("Event hub is not connected, event is delayed."),this._unsentEvents.push(t),this._socketIo.socket.reconnect())}subscribe(t,r,n={}){const s=this._addSubscriber(t,r,n);return this._notifyServerAboutSubscriber(s),s.metadata.id}_getExpressionTopic(t){const r=new RegExp(`^topic[ ]?=[ '"]?([\\w-,./*@+]+)['"]?$`),n=t.trim().match(r);if(n&&n.length===2)return n[1];throw new Error('Only subscriptions on the format "topic=value" are supported.')}_addSubscriber(t,r,n={}){if(this._getExpressionTopic(t),n.id||(n.id=v4_1()),this.getSubscriberByIdentifier(n.id))throw new NotUniqueError(`Subscriber with identifier "${n.id}" already exists.`);const a={subscription:t,callback:r,metadata:n};return this._subscribers.push(a),a}_notifyServerAboutSubscriber(t){const r=new Event("ftrack.meta.subscribe",{subscriber:t.metadata,subscription:t.subscription});this.publish(r)}getSubscriberByIdentifier(t){for(const r of this._subscribers.slice())if(r.metadata.id===t)return r;return null}_IsSubscriberInterestedIn(t,r){return this._getExpressionTopic(t.subscription)===r.topic}_handle(t){this.logger.debug("Event received",t);for(const r of this._subscribers){if(!this._IsSubscriberInterestedIn(r,t))continue;let n=null;try{n=r.callback(t)}catch(s){this.logger.error("Error calling subscriber for event.",s,r,t)}n!=null&&this.publishReply(t,n,r.metadata)}}_handleReply(t){this.logger.debug("Reply received",t);const r=this._replyCallbacks[t.inReplyToEvent];r&&r(t)}publishReply(t,r,n=null){const s=new Event("ftrack.meta.reply",r);return s._data.target=`id=${t.source.id}`,s._data.inReplyToEvent=t.id,n&&(s._data.source=n),this.publish(s)}}function createOperation(e,t){const r={action:"create",entity_type:e};return r.entity_data=Object.assign({},t,{__entity_type__:e}),r}function queryOperation(e){return{action:"query",expression:e}}function searchOperation({expression:e,entityType:t,terms:r,contextId:n,objectTypeIds:s}){return{action:"search",expression:e,entity_type:t,terms:r,context_id:n,object_type_ids:s}}function updateOperation(e,t,r){const n={action:"update",entity_type:e,entity_key:t};return n.entity_data=Object.assign({},r,{__entity_type__:e}),n}function deleteOperation(e,t){return{action:"delete",entity_type:e,entity_key:t}}const exports$2={query:queryOperation,create:createOperation,update:updateOperation,delete:deleteOperation,search:searchOperation},SERVER_LOCATION_ID="3a372bde-05bc-11e4-8908-20c9d081909b";function normalizeString(e){let t=e;try{t=e.normalize()}catch(r){loglevel.warn("Failed to normalize string",e,r)}return t}const logger=loglevel.getLogger("ftrack_api"),ENCODE_DATETIME_FORMAT="YYYY-MM-DDTHH:mm:ss";function splitFileExtension(e){let t=e||"",r=e.slice((Math.max(0,e.lastIndexOf("."))||1/0)+1)||"";return r.length&&(r=`.${r}`,t=e.slice(0,-1*r.length)||""),[t,r]}class Session{constructor(t,r,n,{autoConnectEventHub:s=!1,serverInformationValues:a=null,eventHubOptions:o={},clientToken:c=null,apiEndpoint:l="/api"}={}){if(!t||!r||!n)throw new Error("Invalid arguments, please construct Session with *serverUrl*, *apiUser* and *apiKey*.");this.apiUser=r,this.apiKey=n,this.serverUrl=t,this.apiEndpoint=l,this.eventHub=new EventHub(t,r,n,o),s&&this.eventHub.connect(),c?this.clientToken=c:this.clientToken=`ftrack-javascript-api--${v4_1()}`,a&&!a.includes("is_timezone_support_enabled")&&a.push("is_timezone_support_enabled");const u=[{action:"query_server_information",values:a},{action:"query_schemas"}];this.initialized=!1,this.initializing=this.call(u).then(p=>(this.serverInformation=p[0],this.schemas=p[1],this.serverVersion=this.serverInformation.version,this.initialized=!0,Promise.resolve(this)))}getPrimaryKeyAttributes(t){const r=find_1(this.schemas,n=>n.id===t);return!r||!r.primary_key?(logger.warn("Primary key could not be found for: ",t),null):r.primary_key}getIdentifyingKey(t){const r=this.getPrimaryKeyAttributes(t.__entity_type__);return r?[t.__entity_type__,...r.map(n=>t[n])].join(","):null}encode(t){if(t&&t.constructor===Array)return t.map(r=>this.encode(r));if(t&&t.constructor===Object){const r={};return forIn_1(t,(n,s)=>{r[s]=this.encode(n)}),r}return t&&t._isAMomentObject?this.serverInformation&&this.serverInformation.is_timezone_support_enabled?{__type__:"datetime",value:t.utc().format(ENCODE_DATETIME_FORMAT)}:{__type__:"datetime",value:t.local().format(ENCODE_DATETIME_FORMAT)}:t}getErrorFromResponse(t){let r;return t.exception==="AbortError"?r=AbortError:t.exception==="ValidationError"?r=ServerValidationError:t.exception==="FTAuthenticationError"||t.exception==="PermissionError"?r=ServerPermissionDeniedError:r=ServerError,new r(t.content,t.error_code)}decode(t,r={}){return t==null?t:isArray_1(t)?this._decodeArray(t,r):isPlainObject_1(t)?t.__entity_type__?this._mergeEntity(t,r):t.__type__==="datetime"?this._decodeDateTime(t):this._decodePlainObject(t,r):t}_decodeDateTime(t){return this.serverInformation&&this.serverInformation.is_timezone_support_enabled?moment__default.default.utc(t.value):moment__default.default(t.value)}_decodePlainObject(t,r){return Object.keys(t).reduce((n,s)=>(n[s]=this.decode(t[s],r),n),{})}_decodeArray(t,r){return t.map(n=>this.decode(n,r))}_mergeEntity(t,r){const n=this.getIdentifyingKey(t);if(!n)return logger.warn("Identifier could not be determined for: ",n),t;r[n]||(r[n]={});const s=r[n];return forIn_1(t,(a,o)=>{s[o]=this.decode(a,r)}),s}encodeOperations(t){return JSON.stringify(this.encode(t))}call(t,{abortController:r}={}){const n=`${this.serverUrl}${this.apiEndpoint}`;let s=new Promise(a=>{this.initializing&&!this.initialized?this.initializing.then(()=>{a()}):a()});return s=s.then(()=>fetch(n,{method:"post",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json","ftrack-api-key":this.apiKey,"ftrack-user":this.apiUser,"ftrack-Clienttoken":this.clientToken},body:this.encodeOperations(t),signal:r&&r.signal})),s=s.catch(a=>(logger.warn("Failed to perform request. ",a),a.name==="AbortError"?Promise.resolve({exception:"AbortError",content:a.message}):Promise.resolve({exception:"NetworkError",content:a.message}))),s=s.then(a=>a.json&&a.json()||a),s=s.then(a=>this.initialized?this.decode(a):a),s=s.catch(a=>(logger.warn("Server reported error in unexpected format. ",a),Promise.resolve({exception:"MalformedResponseError",content:a.message,error:a}))),s=s.then(a=>a.exception?Promise.reject(this.getErrorFromResponse(a)):Promise.resolve(a)),s}ensure(t,r,n=[]){let s=n;if(logger.info("Ensuring entity with data using identifying keys: ",t,r,n),s.length||(s=Object.keys(r)),!s.length)throw new Error(`Could not determine any identifying data to check against when ensuring ${t} with data ${r}. Identifying keys: ${n}`);const a=this.getPrimaryKeyAttributes(t);let o=`select ${a.join(", ")} from ${t} where`;const c=s.map(l=>{let u=r[l];return isString_1(u)?u=`"${u}"`:u&&u._isAMomentObject&&(u=moment__default.default(u).utc().format(ENCODE_DATETIME_FORMAT),u=`"${u}"`),`${l} is ${u}`});return o=`${o} ${c.join(" and ")}`,this.query(o).then(l=>{if(l.data.length===0)return this.create(t,r).then(({data:y})=>Promise.resolve(y));if(l.data.length!==1)throw new Error(`Expected single or no item to be found but got multiple when ensuring ${t} with data ${r}. Identifying keys: ${n}`);const u=l.data[0];let p=!1;return Object.keys(r).forEach(y=>{r[y]!==u[y]&&(u[y]=r[y],p=!0)}),p?this.update(t,a.map(y=>u[y]),Object.keys(r).reduce((y,h)=>(a.indexOf(h)===-1&&(y[h]=r[h]),y),{})).then(({data:y})=>Promise.resolve(y)):Promise.resolve(l.data[0])})}getSchema(t){for(const r in this.schemas)if(this.schemas[r].id===t)return this.schemas[r];return null}query(t,{abortController:r}={}){logger.debug("Query",t);const n=queryOperation(t);let s=this.call([n],r);return s=s.then(a=>a[0]),s}search({expression:t,entityType:r,terms:n=[],contextId:s,objectTypeIds:a},{abortController:o}={}){logger.debug("Search",{expression:t,entityType:r,terms:n,contextId:s,objectTypeIds:a});const c=searchOperation({expression:t,entityType:r,terms:n,contextId:s,objectTypeIds:a});let l=this.call([c],o);return l=l.then(u=>u[0]),l}create(t,r){logger.debug("Create",t,r);let n=this.call([createOperation(t,r)]);return n=n.then(s=>s[0]),n}update(t,r,n){logger.debug("Update",t,r,n);let s=this.call([updateOperation(t,r,n)]);return s=s.then(a=>a[0]),s}delete(t,r){logger.debug("Delete",t,r);let n=this.call([deleteOperation(t,r)]);return n=n.then(s=>s[0]),n}getComponentUrl(t){if(!t)return null;const r={id:t,username:this.apiUser,apiKey:this.apiKey};return`${this.serverUrl}/component/get?${encodeUriParameters(r)}`}thumbnailUrl(t,{size:r=300}={}){if(!t)return`${this.serverUrl}/img/thumbnail2.png`;const n={id:t,size:r,username:this.apiUser,apiKey:this.apiKey};return`${this.serverUrl}/component/thumbnail?${encodeUriParameters(n)}`}createComponent(t,r={}){const n=normalizeString(t.name),s=splitFileExtension(n),a=v=>v,o=()=>{},c=r.data||{},l=r.onProgress||a,u=r.xhr||new XMLHttpRequest,p=r.onAborted||o,y=c.file_type||s[1],h=c.name||s[0],d=c.size||t.size,g=c.id||v4_1(),$=v4_1();let _,b;const m=v=>{v.lengthComputable&&l(parseInt(v.loaded/v.total*100,10))};logger.debug("Registering component and fetching upload metadata.");const C=Object.assign(c,{id:g,name:h,file_type:y,size:d}),A={id:$,component_id:g,resource_identifier:g,location_id:SERVER_LOCATION_ID},O=this.call([createOperation("FileComponent",C),createOperation("ComponentLocation",A),{action:"get_upload_metadata",file_name:`${h}${y}`,file_size:d,component_id:g}]).then(v=>(_=v[2].url,b=v[2].headers,v));return O.then(()=>(logger.debug(`Uploading file to: ${_}`),new Promise((v,T)=>{u.upload.addEventListener("progress",m),u.open("PUT",_,!0),u.onabort=()=>{p(),this.delete("FileComponent",[g]).then(()=>{T(new CreateComponentError("Upload aborted by client","UPLOAD_ABORTED"))})};for(const S in b)b.hasOwnProperty(S)&&S!=="Content-Length"&&u.setRequestHeader(S,b[S]);u.onload=()=>{u.status>=400&&T(new CreateComponentError(`Failed to upload file: ${u.status}`)),v(u.response)},u.onerror=()=>{this.delete("FileComponent",[g]).then(()=>{T(new CreateComponentError(`Failed to upload file: ${u.status}`))})},u.send(t)}).then(()=>O)))}}function getStatuses(e,t,r,n=null){let s;const a=["_task_workflow.statuses.name","_task_workflow.statuses.color","_task_workflow.statuses.sort"],o=["_version_workflow.statuses.name","_version_workflow.statuses.color","_version_workflow.statuses.sort"],c=["_overrides.type_id","_overrides.workflow_schema.statuses.name","_overrides.workflow_schema.statuses.sort","_overrides.workflow_schema.statuses.color"],l=["_schemas.type_id","_schemas.statuses.task_status.name","_schemas.statuses.task_status.color","_schemas.statuses.task_status.sort"];let u;r==="Task"&&n!==null?u=[a,c]:r==="Task"?u=[a]:r==="AssetVersion"?u=[o]:u=[l];const p=u.map(y=>exports$2.query(`select ${y.join(", ")} from ProjectSchema where id is ${t}`));return s=e.call(p),s=s.then(y=>{const h=y[0].data[0];let d=[];if(r==="Task"){if(d=null,n!==null&&h._overrides.length>0){for(const g in h._overrides)if(h._overrides[g].type_id===n){d=h._overrides[g].workflow_schema.statuses;break}}d===null&&(d=h._task_workflow.statuses)}else if(r==="AssetVersion")d=h._version_workflow.statuses;else{const g=e.getSchema(r);if(g&&g.alias_for&&g.alias_for.id==="Task"){const $=g.alias_for.classifiers.object_typeid;for(const _ in h._schemas)h._schemas[_].type_id===$&&(d=h._schemas[_].statuses.map(b=>b.task_status))}}return Promise.resolve(d)}),s}const exports$1={getStatuses};exports.Event=Event,exports.EventHub=EventHub,exports.Session=Session,exports.error=exports$3,exports.logger=loglevel,exports.operation=exports$2,exports.projectSchema=exports$1,Object.defineProperty(exports,"__esModule",{value:!0}),exports[Symbol.toStringTag]="Module"});
